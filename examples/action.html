<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script src="../build/roslib.js"></script>

    <script>
      // Connecting to ROS
      // -----------------
      var ros = new ROSLIB.Ros();

      // If there is an error on the backend, an 'error' emit will be emitted.
      ros.on("error", function (error) {
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("error").style.display = "inline";
        console.log(error);
      });

      // Find out exactly when we made a connection.
      ros.on("connection", function () {
        console.log("Connection made!");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("connected").style.display = "inline";
      });

      ros.on("close", function () {
        console.log("Connection closed.");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "inline";
      });

      // Create a connection to the rosbridge WebSocket server.
      ros.connect("ws://localhost:9090");

      
      // First, we create a Service client with details of the service's name and service type.
      const addTwoIntsClient = new ROSLIB.ActionHandle({
        ros: ros,
        name: "/fibonacci",
        actionType: "action_tutorials_interfaces/action/Fibonacci",
      });

      // Then we create a Service Request. The object we pass in to ROSLIB.ServiceRequest matches the
      // fields defined in the rospy_tutorials AddTwoInts.srv file.
      const goal_msg = new ROSLIB.ActionGoal({
        order: 7,
      });
      console.log("jstep1");
      // Finally, we call the /add_two_ints service and get back the results in the callback. The result
      // is a ROSLIB.ServiceResponse object.
      addTwoIntsClient.createClient(goal_msg, function (result) {
        
      });
      console.log("jstep2");
      addTwoIntsClient.on("feedback", function (msg) {
        console.log("feedback", msg.values);
      });
      // Advertising a Service
      // ---------------------
      console.log("jstep3");
      // The Service object does double duty for both calling and advertising services
    </script>
  </head>

  <body>
    <h1>Simple roslib Example</h1>
    <p>
      Run the following commands in the terminal then refresh this page. Check
      the JavaScript console for the output.
    </p>
    <ol>
      <li><tt>roscore</tt></li>
      <li><tt>rostopic pub /listener std_msgs/String "Hello, World"</tt></li>
      <li><tt>rostopic echo /cmd_vel</tt></li>
      <li><tt>rosrun rospy_tutorials add_two_ints_server</tt></li>
      <li><tt>roslaunch rosbridge_server rosbridge_websocket.launch</tt></li>
    </ol>
    <div id="statusIndicator">
      <p id="connecting">Connecting to rosbridge...</p>
      <p id="connected" style="color: #00d600; display: none">Connected</p>
      <p id="error" style="color: #ff0000; display: none">
        Error in the backend!
      </p>
      <p id="closed" style="display: none">Connection closed.</p>
    </div>
  </body>
</html>
